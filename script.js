const translations = {
    en: {
        title: "CodeGuess",
        mode3title: "3 numbers",
        mode4title: "4 numbers",
        mode5title: "5 numbers",
        mode6title: "6 numbers",
        attempts: "Attempts",
        maxattempts: "Max",
        entercode: "Number",
        howtoplay: "How to Play",
        rule1: "Guess the secret code with unique numbers.",
        rule2: "After each guess, the color shows how close you are:",
        correct: "Correct number, correct position",
        present: "Correct number, wrong position",
        absent: "Number not in code",
        close: "Close",
        playagain: "Play Again",
        won: "Victory!",
        lost: "Game Over",
        wondesc: "You guessed the code!",
        lostdesc: "The code was:",
        duplicate: "All numbers must be unique!",
        choosedifficulty: "Choose Difficulty",
        easy: "Easy",
        medium: "Medium",
        hard: "Hard",
        notes: "Notes",
        notesplaceholder: "Write your notes here...",
        attemptstext: "attempts"
    },
    ru: {
        title: "CodeGuess",
        mode3title: "3 Ñ†Ð¸Ñ„Ñ€Ñ‹",
        mode4title: "4 Ñ†Ð¸Ñ„Ñ€Ñ‹",
        mode5title: "5 Ñ†Ð¸Ñ„Ñ€",
        mode6title: "6 Ñ†Ð¸Ñ„Ñ€",
        attempts: "ÐŸÐ¾Ð¿Ñ‹Ñ‚ÐºÐ¸",
        maxattempts: "ÐœÐ°ÐºÑ",
        entercode: "ÐÐ¾Ð¼ÐµÑ€",
        howtoplay: "ÐšÐ°Ðº Ð¸Ð³Ñ€Ð°Ñ‚ÑŒ",
        rule1: "Ð£Ð³Ð°Ð´Ð°Ð¹Ñ‚Ðµ ÑÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ ÐºÐ¾Ð´ Ñ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ñ†Ð¸Ñ„Ñ€Ð°Ð¼Ð¸.",
        rule2: "ÐŸÐ¾ÑÐ»Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð¹ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ¸ Ñ†Ð²ÐµÑ‚ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð½Ð°ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð²Ñ‹ Ð±Ð»Ð¸Ð·ÐºÐ¸:",
        correct: "ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ñ†Ð¸Ñ„Ñ€Ð°, Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ",
        present: "ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ñ†Ð¸Ñ„Ñ€Ð°, Ð½ÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ",
        absent: "Ð¦Ð¸Ñ„Ñ€Ñ‹ Ð½ÐµÑ‚ Ð² ÐºÐ¾Ð´Ðµ",
        close: "Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ",
        playagain: "Ð˜Ð³Ñ€Ð°Ñ‚ÑŒ ÑÐ½Ð¾Ð²Ð°",
        won: "ÐŸÐ¾Ð±ÐµÐ´Ð°!",
        lost: "Ð˜Ð³Ñ€Ð° Ð¾ÐºÐ¾Ð½Ñ‡ÐµÐ½Ð°",
        wondesc: "Ð’Ñ‹ ÑƒÐ³Ð°Ð´Ð°Ð»Ð¸ ÐºÐ¾Ð´!",
        lostdesc: "ÐšÐ¾Ð´ Ð±Ñ‹Ð»:",
        duplicate: "Ð’ÑÐµ Ñ†Ð¸Ñ„Ñ€Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸!",
        choosedifficulty: "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ»Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ",
        easy: "Ð›ÐµÐ³ÐºÐ¾",
        medium: "Ð¡Ñ€ÐµÐ´Ð½Ðµ",
        hard: "Ð¡Ð»Ð¾Ð¶Ð½Ð¾",
        notes: "Ð—Ð°Ð¼ÐµÑ‚ÐºÐ¸",
        notesplaceholder: "ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÑÐ²Ð¾Ð¸ Ð·Ð°Ð¼ÐµÑ‚ÐºÐ¸ Ð·Ð´ÐµÑÑŒ...",
        attemptstext: "Ð¿Ð¾Ð¿Ñ‹Ñ‚Ð¾Ðº"
    },
    ro: {
        title: "CodeGuess",
        mode3title: "3 cifre",
        mode4title: "4 cifre",
        mode5title: "5 cifre",
        mode6title: "6 cifre",
        attempts: "ÃŽncercÄƒri",
        maxattempts: "Max",
        entercode: "NumÄƒrul",
        howtoplay: "Cum se joacÄƒ",
        rule1: "GhiceÈ™te codul secret cu cifre unice.",
        rule2: "DupÄƒ fiecare Ã®ncercare, culoarea aratÄƒ cÃ¢t de aproape eÈ™ti:",
        correct: "CifrÄƒ corectÄƒ, poziÈ›ie corectÄƒ",
        present: "CifrÄƒ corectÄƒ, poziÈ›ie greÈ™itÄƒ",
        absent: "Cifra nu existÄƒ Ã®n cod",
        close: "ÃŽnchide",
        playagain: "JoacÄƒ din nou",
        won: "Victorie!",
        lost: "Joc terminat",
        wondesc: "Ai ghicit codul!",
        lostdesc: "Codul era:",
        duplicate: "Toate cifrele trebuie sÄƒ fie unice!",
        choosedifficulty: "Alege Dificultatea",
        easy: "UÈ™or",
        medium: "Mediu",
        hard: "Dificil",
        notes: "NotiÈ›e",
        notesplaceholder: "Scrie notiÈ›ele tale aici...",
        attemptstext: "Ã®ncercÄƒri"
    }
};

let currentLang = 'en';
let secretCode = [];
let maxAttempts = 6;
let currentAttempts = 0;
let gameMode = 0;
let gameActive = false;
let selectedMode = 0;
let discoveredNumbers = new Set();
let allNumbersFound = new Set();

function setLanguage(lang) {
    currentLang = lang;
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.textContent = translations[lang][key];
    });
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        el.placeholder = translations[lang][key];
    });
    
    if (selectedMode > 0) {
        updateDifficultyAttempts();
    }
}

function generateCode(length) {
    const numbers = [0,1,2,3,4,5,6,7,8,9];
    const code = [];
    for (let i = 0; i < length; i++) {
        const idx = Math.floor(Math.random() * numbers.length);
        code.push(numbers[idx]);
        numbers.splice(idx, 1);
    }
    return code;
}

function updateDifficultyAttempts() {
    const attemptsMap = {
        3: { easy: 6, medium: 4, hard: 3 },
        4: { easy: 6, medium: 5, hard: 4 },
        5: { easy: 8, medium: 6, hard: 4 },
        6: { easy: 10, medium: 8, hard: 6 }
    };
    
    document.querySelectorAll('.difficulty-btn').forEach(btn => {
        const difficulty = btn.getAttribute('data-difficulty');
        const attemptsDiv = btn.querySelector('.difficulty-attempts');
        attemptsDiv.textContent = `${attemptsMap[selectedMode][difficulty]} ${translations[currentLang].attemptstext}`;
    });
}

function updateDiscoveredNumbers() {
    const container = document.getElementById('discoveredNumbers');
    container.innerHTML = '';
    
    // CreÄƒm un set cu toate cifrele gÄƒsite (oriunde Ã®n cod)
    const foundNumbers = new Set([...discoveredNumbers, ...allNumbersFound]);
    
    // AfiÈ™Äƒm doar cifrele descoperite, fÄƒrÄƒ sÄƒ arÄƒtÄƒm poziÈ›iile lor
    foundNumbers.forEach((number) => {
        const cell = document.createElement('div');
        cell.className = 'discovered-cell';
        cell.textContent = number;
        
        if (discoveredNumbers.has(number)) {
            cell.classList.add('found');
        } else {
            cell.classList.add('present');
        }
        
        container.appendChild(cell);
    });
}

function startGame(mode, difficulty) {
    gameMode = parseInt(mode);
    const attemptsMap = {
        3: { easy: 6, medium: 4, hard: 3 },
        4: { easy: 6, medium: 5, hard: 4 },
        5: { easy: 8, medium: 6, hard: 4 },
        6: { easy: 10, medium: 8, hard: 6 }
    };
    
    maxAttempts = attemptsMap[mode][difficulty];
    
    secretCode = generateCode(gameMode);
    currentAttempts = 0;
    gameActive = true;
    discoveredNumbers = new Set();
    allNumbersFound = new Set();

    document.getElementById('difficultySelector').classList.remove('active');
    document.getElementById('gameArea').classList.add('active');
    document.getElementById('backBtn').classList.add('active');
    document.getElementById('codeInput').maxLength = gameMode;
    document.getElementById('attemptsValue').textContent = '0';
    document.getElementById('maxAttemptsValue').textContent = maxAttempts;
    document.getElementById('guessesContainer').innerHTML = '';
    document.getElementById('codeInput').value = '';
    
    updateDiscoveredNumbers();
}

function checkGuess(guess) {
    const guessArr = guess.split('').map(Number);
    const feedback = [];

    guessArr.forEach((number, idx) => {
        if (number === secretCode[idx]) {
            feedback.push('correct');
            discoveredNumbers.add(number);
        } else if (secretCode.includes(number)) {
            feedback.push('present');
            allNumbersFound.add(number);
        } else {
            feedback.push('absent');
        }
    });

    return feedback;
}

function displayGuess(guess, feedback) {
    const row = document.createElement('div');
    row.className = 'guess-row';

    guess.split('').forEach((number, idx) => {
        const cell = document.createElement('div');
        cell.className = `guess-cell ${feedback[idx]}`;
        cell.textContent = number;
        row.appendChild(cell);
    });

    document.getElementById('guessesContainer').appendChild(row);
}

function endGame(won) {
    gameActive = false;
    const modal = document.getElementById('resultModal');
    const icon = document.getElementById('resultIcon');
    const title = document.getElementById('resultTitle');
    const text = document.getElementById('resultText');

    if (won) {
        icon.textContent = 'ðŸŽ‰';
        title.textContent = translations[currentLang].won;
        text.textContent = translations[currentLang].wondesc;
    } else {
        icon.textContent = 'ðŸ˜”';
        title.textContent = translations[currentLang].lost;
        text.textContent = `${translations[currentLang].lostdesc} ${secretCode.join('')}`;
    }

    modal.classList.add('active');
}

document.querySelectorAll('.mode-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        selectedMode = parseInt(btn.getAttribute('data-mode'));
        document.getElementById('menuSelector').classList.remove('active');
        document.getElementById('difficultySelector').classList.add('active');
        updateDifficultyAttempts();
    });
});

document.querySelectorAll('.difficulty-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        const difficulty = btn.getAttribute('data-difficulty');
        startGame(selectedMode, difficulty);
    });
});

document.getElementById('submitBtn').addEventListener('click', () => {
    const input = document.getElementById('codeInput');
    const guess = input.value;

    if (!gameActive || guess.length !== gameMode) return;

    const numbers = guess.split('');
    if (new Set(numbers).size !== numbers.length) {
        alert(translations[currentLang].duplicate);
        return;
    }

    const feedback = checkGuess(guess);
    displayGuess(guess, feedback);
    currentAttempts++;
    document.getElementById('attemptsValue').textContent = currentAttempts;
    
    updateDiscoveredNumbers();

    if (feedback.every(f => f === 'correct')) {
        endGame(true);
    } else if (currentAttempts >= maxAttempts) {
        endGame(false);
    }

    input.value = '';
});

document.getElementById('codeInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        document.getElementById('submitBtn').click();
    }
});

document.getElementById('codeInput').addEventListener('input', (e) => {
    e.target.value = e.target.value.replace(/[^0-9]/g, '');
});

document.getElementById('helpBtn').addEventListener('click', () => {
    document.getElementById('helpModal').classList.add('active');
});

document.getElementById('closeHelp').addEventListener('click', () => {
    document.getElementById('helpModal').classList.remove('active');
});

document.getElementById('notesBtn').addEventListener('click', () => {
    document.getElementById('notesModal').classList.add('active');
});

document.getElementById('closeNotesX').addEventListener('click', () => {
    document.getElementById('notesModal').classList.remove('active');
});

document.getElementById('playAgain').addEventListener('click', () => {
    document.getElementById('resultModal').classList.remove('active');
    document.getElementById('gameArea').classList.remove('active');
    document.getElementById('backBtn').classList.remove('active');
    document.getElementById('menuSelector').classList.add('active');
});

document.getElementById('backBtn').addEventListener('click', () => {
    document.getElementById('gameArea').classList.remove('active');
    document.getElementById('difficultySelector').classList.remove('active');
    document.getElementById('backBtn').classList.remove('active');
    document.getElementById('menuSelector').classList.add('active');
    gameActive = false;
});

document.getElementById('langBtn').addEventListener('click', (e) => {
    e.stopPropagation();
    document.getElementById('langMenu').classList.toggle('active');
});

document.querySelectorAll('.lang-option').forEach(option => {
    option.addEventListener('click', (e) => {
        e.stopPropagation();
        const lang = option.getAttribute('data-lang');
        setLanguage(lang);
        document.getElementById('langMenu').classList.remove('active');
        
        document.querySelectorAll('.lang-option').forEach(opt => {
            opt.classList.remove('selected');
        });
        option.classList.add('selected');
    });
});

document.addEventListener('click', (e) => {
    const langBtn = document.getElementById('langBtn');
    const langMenu = document.getElementById('langMenu');
    if (!langBtn.contains(e.target) && !langMenu.contains(e.target)) {
        langMenu.classList.remove('active');
    }
});

setLanguage('en');